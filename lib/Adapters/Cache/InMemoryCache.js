"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.InMemoryCache = void 0;
const DEFAULT_CACHE_TTL = 5 * 1000;

class InMemoryCache {
  constructor({
    ttl = DEFAULT_CACHE_TTL
  }) {
    this.ttl = ttl;
    this.cache = Object.create(null);
  }

  get(key) {
    const record = this.cache[key];

    if (record == null) {
      return null;
    } // Has Record and isnt expired


    if (isNaN(record.expire) || record.expire >= Date.now()) {
      return record.value;
    } // Record has expired


    delete this.cache[key];
    return null;
  }

  put(key, value, ttl = this.ttl) {
    if (ttl < 0 || isNaN(ttl)) {
      ttl = NaN;
    }

    var record = {
      value: value,
      expire: ttl + Date.now()
    };

    if (!isNaN(record.expire)) {
      record.timeout = setTimeout(() => {
        this.del(key);
      }, ttl);
    }

    this.cache[key] = record;
  }

  del(key) {
    var record = this.cache[key];

    if (record == null) {
      return;
    }

    if (record.timeout) {
      clearTimeout(record.timeout);
    }

    delete this.cache[key];
  }

  clear() {
    this.cache = Object.create(null);
  }

}

exports.InMemoryCache = InMemoryCache;
var _default = InMemoryCache;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX0NBQ0hFX1RUTCIsIkluTWVtb3J5Q2FjaGUiLCJjb25zdHJ1Y3RvciIsInR0bCIsImNhY2hlIiwiT2JqZWN0IiwiY3JlYXRlIiwiZ2V0Iiwia2V5IiwicmVjb3JkIiwiaXNOYU4iLCJleHBpcmUiLCJEYXRlIiwibm93IiwidmFsdWUiLCJwdXQiLCJOYU4iLCJ0aW1lb3V0Iiwic2V0VGltZW91dCIsImRlbCIsImNsZWFyVGltZW91dCIsImNsZWFyIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL0FkYXB0ZXJzL0NhY2hlL0luTWVtb3J5Q2FjaGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgREVGQVVMVF9DQUNIRV9UVEwgPSA1ICogMTAwMDtcblxuZXhwb3J0IGNsYXNzIEluTWVtb3J5Q2FjaGUge1xuICBjb25zdHJ1Y3Rvcih7IHR0bCA9IERFRkFVTFRfQ0FDSEVfVFRMIH0pIHtcbiAgICB0aGlzLnR0bCA9IHR0bDtcbiAgICB0aGlzLmNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgfVxuXG4gIGdldChrZXkpIHtcbiAgICBjb25zdCByZWNvcmQgPSB0aGlzLmNhY2hlW2tleV07XG4gICAgaWYgKHJlY29yZCA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBIYXMgUmVjb3JkIGFuZCBpc250IGV4cGlyZWRcbiAgICBpZiAoaXNOYU4ocmVjb3JkLmV4cGlyZSkgfHwgcmVjb3JkLmV4cGlyZSA+PSBEYXRlLm5vdygpKSB7XG4gICAgICByZXR1cm4gcmVjb3JkLnZhbHVlO1xuICAgIH1cblxuICAgIC8vIFJlY29yZCBoYXMgZXhwaXJlZFxuICAgIGRlbGV0ZSB0aGlzLmNhY2hlW2tleV07XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwdXQoa2V5LCB2YWx1ZSwgdHRsID0gdGhpcy50dGwpIHtcbiAgICBpZiAodHRsIDwgMCB8fCBpc05hTih0dGwpKSB7XG4gICAgICB0dGwgPSBOYU47XG4gICAgfVxuXG4gICAgdmFyIHJlY29yZCA9IHtcbiAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgIGV4cGlyZTogdHRsICsgRGF0ZS5ub3coKSxcbiAgICB9O1xuXG4gICAgaWYgKCFpc05hTihyZWNvcmQuZXhwaXJlKSkge1xuICAgICAgcmVjb3JkLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5kZWwoa2V5KTtcbiAgICAgIH0sIHR0bCk7XG4gICAgfVxuXG4gICAgdGhpcy5jYWNoZVtrZXldID0gcmVjb3JkO1xuICB9XG5cbiAgZGVsKGtleSkge1xuICAgIHZhciByZWNvcmQgPSB0aGlzLmNhY2hlW2tleV07XG4gICAgaWYgKHJlY29yZCA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHJlY29yZC50aW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQocmVjb3JkLnRpbWVvdXQpO1xuICAgIH1cbiAgICBkZWxldGUgdGhpcy5jYWNoZVtrZXldO1xuICB9XG5cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5jYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgSW5NZW1vcnlDYWNoZTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsTUFBTUEsaUJBQWlCLEdBQUcsSUFBSSxJQUE5Qjs7QUFFTyxNQUFNQyxhQUFOLENBQW9CO0VBQ3pCQyxXQUFXLENBQUM7SUFBRUMsR0FBRyxHQUFHSDtFQUFSLENBQUQsRUFBOEI7SUFDdkMsS0FBS0csR0FBTCxHQUFXQSxHQUFYO0lBQ0EsS0FBS0MsS0FBTCxHQUFhQyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxJQUFkLENBQWI7RUFDRDs7RUFFREMsR0FBRyxDQUFDQyxHQUFELEVBQU07SUFDUCxNQUFNQyxNQUFNLEdBQUcsS0FBS0wsS0FBTCxDQUFXSSxHQUFYLENBQWY7O0lBQ0EsSUFBSUMsTUFBTSxJQUFJLElBQWQsRUFBb0I7TUFDbEIsT0FBTyxJQUFQO0lBQ0QsQ0FKTSxDQU1QOzs7SUFDQSxJQUFJQyxLQUFLLENBQUNELE1BQU0sQ0FBQ0UsTUFBUixDQUFMLElBQXdCRixNQUFNLENBQUNFLE1BQVAsSUFBaUJDLElBQUksQ0FBQ0MsR0FBTCxFQUE3QyxFQUF5RDtNQUN2RCxPQUFPSixNQUFNLENBQUNLLEtBQWQ7SUFDRCxDQVRNLENBV1A7OztJQUNBLE9BQU8sS0FBS1YsS0FBTCxDQUFXSSxHQUFYLENBQVA7SUFDQSxPQUFPLElBQVA7RUFDRDs7RUFFRE8sR0FBRyxDQUFDUCxHQUFELEVBQU1NLEtBQU4sRUFBYVgsR0FBRyxHQUFHLEtBQUtBLEdBQXhCLEVBQTZCO0lBQzlCLElBQUlBLEdBQUcsR0FBRyxDQUFOLElBQVdPLEtBQUssQ0FBQ1AsR0FBRCxDQUFwQixFQUEyQjtNQUN6QkEsR0FBRyxHQUFHYSxHQUFOO0lBQ0Q7O0lBRUQsSUFBSVAsTUFBTSxHQUFHO01BQ1hLLEtBQUssRUFBRUEsS0FESTtNQUVYSCxNQUFNLEVBQUVSLEdBQUcsR0FBR1MsSUFBSSxDQUFDQyxHQUFMO0lBRkgsQ0FBYjs7SUFLQSxJQUFJLENBQUNILEtBQUssQ0FBQ0QsTUFBTSxDQUFDRSxNQUFSLENBQVYsRUFBMkI7TUFDekJGLE1BQU0sQ0FBQ1EsT0FBUCxHQUFpQkMsVUFBVSxDQUFDLE1BQU07UUFDaEMsS0FBS0MsR0FBTCxDQUFTWCxHQUFUO01BQ0QsQ0FGMEIsRUFFeEJMLEdBRndCLENBQTNCO0lBR0Q7O0lBRUQsS0FBS0MsS0FBTCxDQUFXSSxHQUFYLElBQWtCQyxNQUFsQjtFQUNEOztFQUVEVSxHQUFHLENBQUNYLEdBQUQsRUFBTTtJQUNQLElBQUlDLE1BQU0sR0FBRyxLQUFLTCxLQUFMLENBQVdJLEdBQVgsQ0FBYjs7SUFDQSxJQUFJQyxNQUFNLElBQUksSUFBZCxFQUFvQjtNQUNsQjtJQUNEOztJQUVELElBQUlBLE1BQU0sQ0FBQ1EsT0FBWCxFQUFvQjtNQUNsQkcsWUFBWSxDQUFDWCxNQUFNLENBQUNRLE9BQVIsQ0FBWjtJQUNEOztJQUNELE9BQU8sS0FBS2IsS0FBTCxDQUFXSSxHQUFYLENBQVA7RUFDRDs7RUFFRGEsS0FBSyxHQUFHO0lBQ04sS0FBS2pCLEtBQUwsR0FBYUMsTUFBTSxDQUFDQyxNQUFQLENBQWMsSUFBZCxDQUFiO0VBQ0Q7O0FBdkR3Qjs7O2VBMERaTCxhIn0=