"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.EventEmitterMQ = void 0;

var _events = _interopRequireDefault(require("events"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const emitter = new _events.default.EventEmitter();
const subscriptions = new Map();

function unsubscribe(channel) {
  if (!subscriptions.has(channel)) {
    //console.log('No channel to unsub from');
    return;
  } //console.log('unsub ', channel);


  emitter.removeListener(channel, subscriptions.get(channel));
  subscriptions.delete(channel);
}

class Publisher {
  constructor(emitter) {
    this.emitter = emitter;
  }

  publish(channel, message) {
    this.emitter.emit(channel, message);
  }

}

class Consumer extends _events.default.EventEmitter {
  constructor(emitter) {
    super();
    this.emitter = emitter;
  }

  subscribe(channel) {
    unsubscribe(channel);

    const handler = message => {
      this.emit('message', channel, message);
    };

    subscriptions.set(channel, handler);
    this.emitter.on(channel, handler);
  }

  unsubscribe(channel) {
    unsubscribe(channel);
  }

}

function createPublisher() {
  return new Publisher(emitter);
}

function createSubscriber() {
  return new Consumer(emitter);
}

const EventEmitterMQ = {
  createPublisher,
  createSubscriber
};
exports.EventEmitterMQ = EventEmitterMQ;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJlbWl0dGVyIiwiZXZlbnRzIiwiRXZlbnRFbWl0dGVyIiwic3Vic2NyaXB0aW9ucyIsIk1hcCIsInVuc3Vic2NyaWJlIiwiY2hhbm5lbCIsImhhcyIsInJlbW92ZUxpc3RlbmVyIiwiZ2V0IiwiZGVsZXRlIiwiUHVibGlzaGVyIiwiY29uc3RydWN0b3IiLCJwdWJsaXNoIiwibWVzc2FnZSIsImVtaXQiLCJDb25zdW1lciIsInN1YnNjcmliZSIsImhhbmRsZXIiLCJzZXQiLCJvbiIsImNyZWF0ZVB1Ymxpc2hlciIsImNyZWF0ZVN1YnNjcmliZXIiLCJFdmVudEVtaXR0ZXJNUSJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9NZXNzYWdlUXVldWUvRXZlbnRFbWl0dGVyTVEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV2ZW50cyBmcm9tICdldmVudHMnO1xuXG5jb25zdCBlbWl0dGVyID0gbmV3IGV2ZW50cy5FdmVudEVtaXR0ZXIoKTtcbmNvbnN0IHN1YnNjcmlwdGlvbnMgPSBuZXcgTWFwKCk7XG5cbmZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNoYW5uZWw6IHN0cmluZykge1xuICBpZiAoIXN1YnNjcmlwdGlvbnMuaGFzKGNoYW5uZWwpKSB7XG4gICAgLy9jb25zb2xlLmxvZygnTm8gY2hhbm5lbCB0byB1bnN1YiBmcm9tJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vY29uc29sZS5sb2coJ3Vuc3ViICcsIGNoYW5uZWwpO1xuICBlbWl0dGVyLnJlbW92ZUxpc3RlbmVyKGNoYW5uZWwsIHN1YnNjcmlwdGlvbnMuZ2V0KGNoYW5uZWwpKTtcbiAgc3Vic2NyaXB0aW9ucy5kZWxldGUoY2hhbm5lbCk7XG59XG5cbmNsYXNzIFB1Ymxpc2hlciB7XG4gIGVtaXR0ZXI6IGFueTtcblxuICBjb25zdHJ1Y3RvcihlbWl0dGVyOiBhbnkpIHtcbiAgICB0aGlzLmVtaXR0ZXIgPSBlbWl0dGVyO1xuICB9XG5cbiAgcHVibGlzaChjaGFubmVsOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuZW1pdHRlci5lbWl0KGNoYW5uZWwsIG1lc3NhZ2UpO1xuICB9XG59XG5cbmNsYXNzIENvbnN1bWVyIGV4dGVuZHMgZXZlbnRzLkV2ZW50RW1pdHRlciB7XG4gIGVtaXR0ZXI6IGFueTtcblxuICBjb25zdHJ1Y3RvcihlbWl0dGVyOiBhbnkpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuZW1pdHRlciA9IGVtaXR0ZXI7XG4gIH1cblxuICBzdWJzY3JpYmUoY2hhbm5lbDogc3RyaW5nKTogdm9pZCB7XG4gICAgdW5zdWJzY3JpYmUoY2hhbm5lbCk7XG4gICAgY29uc3QgaGFuZGxlciA9IG1lc3NhZ2UgPT4ge1xuICAgICAgdGhpcy5lbWl0KCdtZXNzYWdlJywgY2hhbm5lbCwgbWVzc2FnZSk7XG4gICAgfTtcbiAgICBzdWJzY3JpcHRpb25zLnNldChjaGFubmVsLCBoYW5kbGVyKTtcbiAgICB0aGlzLmVtaXR0ZXIub24oY2hhbm5lbCwgaGFuZGxlcik7XG4gIH1cblxuICB1bnN1YnNjcmliZShjaGFubmVsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB1bnN1YnNjcmliZShjaGFubmVsKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVQdWJsaXNoZXIoKTogYW55IHtcbiAgcmV0dXJuIG5ldyBQdWJsaXNoZXIoZW1pdHRlcik7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmliZXIoKTogYW55IHtcbiAgcmV0dXJuIG5ldyBDb25zdW1lcihlbWl0dGVyKTtcbn1cblxuY29uc3QgRXZlbnRFbWl0dGVyTVEgPSB7XG4gIGNyZWF0ZVB1Ymxpc2hlcixcbiAgY3JlYXRlU3Vic2NyaWJlcixcbn07XG5cbmV4cG9ydCB7IEV2ZW50RW1pdHRlck1RIH07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7OztBQUVBLE1BQU1BLE9BQU8sR0FBRyxJQUFJQyxlQUFBLENBQU9DLFlBQVgsRUFBaEI7QUFDQSxNQUFNQyxhQUFhLEdBQUcsSUFBSUMsR0FBSixFQUF0Qjs7QUFFQSxTQUFTQyxXQUFULENBQXFCQyxPQUFyQixFQUFzQztFQUNwQyxJQUFJLENBQUNILGFBQWEsQ0FBQ0ksR0FBZCxDQUFrQkQsT0FBbEIsQ0FBTCxFQUFpQztJQUMvQjtJQUNBO0VBQ0QsQ0FKbUMsQ0FLcEM7OztFQUNBTixPQUFPLENBQUNRLGNBQVIsQ0FBdUJGLE9BQXZCLEVBQWdDSCxhQUFhLENBQUNNLEdBQWQsQ0FBa0JILE9BQWxCLENBQWhDO0VBQ0FILGFBQWEsQ0FBQ08sTUFBZCxDQUFxQkosT0FBckI7QUFDRDs7QUFFRCxNQUFNSyxTQUFOLENBQWdCO0VBR2RDLFdBQVcsQ0FBQ1osT0FBRCxFQUFlO0lBQ3hCLEtBQUtBLE9BQUwsR0FBZUEsT0FBZjtFQUNEOztFQUVEYSxPQUFPLENBQUNQLE9BQUQsRUFBa0JRLE9BQWxCLEVBQXlDO0lBQzlDLEtBQUtkLE9BQUwsQ0FBYWUsSUFBYixDQUFrQlQsT0FBbEIsRUFBMkJRLE9BQTNCO0VBQ0Q7O0FBVGE7O0FBWWhCLE1BQU1FLFFBQU4sU0FBdUJmLGVBQUEsQ0FBT0MsWUFBOUIsQ0FBMkM7RUFHekNVLFdBQVcsQ0FBQ1osT0FBRCxFQUFlO0lBQ3hCO0lBQ0EsS0FBS0EsT0FBTCxHQUFlQSxPQUFmO0VBQ0Q7O0VBRURpQixTQUFTLENBQUNYLE9BQUQsRUFBd0I7SUFDL0JELFdBQVcsQ0FBQ0MsT0FBRCxDQUFYOztJQUNBLE1BQU1ZLE9BQU8sR0FBR0osT0FBTyxJQUFJO01BQ3pCLEtBQUtDLElBQUwsQ0FBVSxTQUFWLEVBQXFCVCxPQUFyQixFQUE4QlEsT0FBOUI7SUFDRCxDQUZEOztJQUdBWCxhQUFhLENBQUNnQixHQUFkLENBQWtCYixPQUFsQixFQUEyQlksT0FBM0I7SUFDQSxLQUFLbEIsT0FBTCxDQUFhb0IsRUFBYixDQUFnQmQsT0FBaEIsRUFBeUJZLE9BQXpCO0VBQ0Q7O0VBRURiLFdBQVcsQ0FBQ0MsT0FBRCxFQUF3QjtJQUNqQ0QsV0FBVyxDQUFDQyxPQUFELENBQVg7RUFDRDs7QUFuQndDOztBQXNCM0MsU0FBU2UsZUFBVCxHQUFnQztFQUM5QixPQUFPLElBQUlWLFNBQUosQ0FBY1gsT0FBZCxDQUFQO0FBQ0Q7O0FBRUQsU0FBU3NCLGdCQUFULEdBQWlDO0VBQy9CLE9BQU8sSUFBSU4sUUFBSixDQUFhaEIsT0FBYixDQUFQO0FBQ0Q7O0FBRUQsTUFBTXVCLGNBQWMsR0FBRztFQUNyQkYsZUFEcUI7RUFFckJDO0FBRnFCLENBQXZCIn0=