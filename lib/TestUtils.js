"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.destroyAllDataPermanently = destroyAllDataPermanently;

var _cache = _interopRequireDefault(require("./cache"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Destroys all data in the database
 * @param {boolean} fast set to true if it's ok to just drop objects and not indexes.
 */
function destroyAllDataPermanently(fast) {
  if (!process.env.TESTING) {
    throw 'Only supported in test environment';
  }

  return Promise.all(Object.keys(_cache.default.cache).map(appId => {
    const app = _cache.default.get(appId);

    if (app.databaseController) {
      return app.databaseController.deleteEverything(fast);
    } else {
      return Promise.resolve();
    }
  }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZXN0cm95QWxsRGF0YVBlcm1hbmVudGx5IiwiZmFzdCIsInByb2Nlc3MiLCJlbnYiLCJURVNUSU5HIiwiUHJvbWlzZSIsImFsbCIsIk9iamVjdCIsImtleXMiLCJBcHBDYWNoZSIsImNhY2hlIiwibWFwIiwiYXBwSWQiLCJhcHAiLCJnZXQiLCJkYXRhYmFzZUNvbnRyb2xsZXIiLCJkZWxldGVFdmVyeXRoaW5nIiwicmVzb2x2ZSJdLCJzb3VyY2VzIjpbIi4uL3NyYy9UZXN0VXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFwcENhY2hlIGZyb20gJy4vY2FjaGUnO1xuXG4vKipcbiAqIERlc3Ryb3lzIGFsbCBkYXRhIGluIHRoZSBkYXRhYmFzZVxuICogQHBhcmFtIHtib29sZWFufSBmYXN0IHNldCB0byB0cnVlIGlmIGl0J3Mgb2sgdG8ganVzdCBkcm9wIG9iamVjdHMgYW5kIG5vdCBpbmRleGVzLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVzdHJveUFsbERhdGFQZXJtYW5lbnRseShmYXN0KSB7XG4gIGlmICghcHJvY2Vzcy5lbnYuVEVTVElORykge1xuICAgIHRocm93ICdPbmx5IHN1cHBvcnRlZCBpbiB0ZXN0IGVudmlyb25tZW50JztcbiAgfVxuICByZXR1cm4gUHJvbWlzZS5hbGwoXG4gICAgT2JqZWN0LmtleXMoQXBwQ2FjaGUuY2FjaGUpLm1hcChhcHBJZCA9PiB7XG4gICAgICBjb25zdCBhcHAgPSBBcHBDYWNoZS5nZXQoYXBwSWQpO1xuICAgICAgaWYgKGFwcC5kYXRhYmFzZUNvbnRyb2xsZXIpIHtcbiAgICAgICAgcmV0dXJuIGFwcC5kYXRhYmFzZUNvbnRyb2xsZXIuZGVsZXRlRXZlcnl0aGluZyhmYXN0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgIH1cbiAgICB9KVxuICApO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLFNBQVNBLHlCQUFULENBQW1DQyxJQUFuQyxFQUF5QztFQUM5QyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxPQUFqQixFQUEwQjtJQUN4QixNQUFNLG9DQUFOO0VBQ0Q7O0VBQ0QsT0FBT0MsT0FBTyxDQUFDQyxHQUFSLENBQ0xDLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZQyxjQUFBLENBQVNDLEtBQXJCLEVBQTRCQyxHQUE1QixDQUFnQ0MsS0FBSyxJQUFJO0lBQ3ZDLE1BQU1DLEdBQUcsR0FBR0osY0FBQSxDQUFTSyxHQUFULENBQWFGLEtBQWIsQ0FBWjs7SUFDQSxJQUFJQyxHQUFHLENBQUNFLGtCQUFSLEVBQTRCO01BQzFCLE9BQU9GLEdBQUcsQ0FBQ0Usa0JBQUosQ0FBdUJDLGdCQUF2QixDQUF3Q2YsSUFBeEMsQ0FBUDtJQUNELENBRkQsTUFFTztNQUNMLE9BQU9JLE9BQU8sQ0FBQ1ksT0FBUixFQUFQO0lBQ0Q7RUFDRixDQVBELENBREssQ0FBUDtBQVVEIn0=