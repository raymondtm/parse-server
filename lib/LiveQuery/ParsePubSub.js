"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ParsePubSub = void 0;

var _AdapterLoader = require("../Adapters/AdapterLoader");

var _EventEmitterPubSub = require("../Adapters/PubSub/EventEmitterPubSub");

var _RedisPubSub = require("../Adapters/PubSub/RedisPubSub");

const ParsePubSub = {};
exports.ParsePubSub = ParsePubSub;

function useRedis(config) {
  const redisURL = config.redisURL;
  return typeof redisURL !== 'undefined' && redisURL !== '';
}

ParsePubSub.createPublisher = function (config) {
  if (useRedis(config)) {
    return _RedisPubSub.RedisPubSub.createPublisher(config);
  } else {
    const adapter = (0, _AdapterLoader.loadAdapter)(config.pubSubAdapter, _EventEmitterPubSub.EventEmitterPubSub, config);

    if (typeof adapter.createPublisher !== 'function') {
      throw 'pubSubAdapter should have createPublisher()';
    }

    return adapter.createPublisher(config);
  }
};

ParsePubSub.createSubscriber = function (config) {
  if (useRedis(config)) {
    return _RedisPubSub.RedisPubSub.createSubscriber(config);
  } else {
    const adapter = (0, _AdapterLoader.loadAdapter)(config.pubSubAdapter, _EventEmitterPubSub.EventEmitterPubSub, config);

    if (typeof adapter.createSubscriber !== 'function') {
      throw 'pubSubAdapter should have createSubscriber()';
    }

    return adapter.createSubscriber(config);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQYXJzZVB1YlN1YiIsInVzZVJlZGlzIiwiY29uZmlnIiwicmVkaXNVUkwiLCJjcmVhdGVQdWJsaXNoZXIiLCJSZWRpc1B1YlN1YiIsImFkYXB0ZXIiLCJsb2FkQWRhcHRlciIsInB1YlN1YkFkYXB0ZXIiLCJFdmVudEVtaXR0ZXJQdWJTdWIiLCJjcmVhdGVTdWJzY3JpYmVyIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL0xpdmVRdWVyeS9QYXJzZVB1YlN1Yi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBsb2FkQWRhcHRlciB9IGZyb20gJy4uL0FkYXB0ZXJzL0FkYXB0ZXJMb2FkZXInO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyUHViU3ViIH0gZnJvbSAnLi4vQWRhcHRlcnMvUHViU3ViL0V2ZW50RW1pdHRlclB1YlN1Yic7XG5cbmltcG9ydCB7IFJlZGlzUHViU3ViIH0gZnJvbSAnLi4vQWRhcHRlcnMvUHViU3ViL1JlZGlzUHViU3ViJztcblxuY29uc3QgUGFyc2VQdWJTdWIgPSB7fTtcblxuZnVuY3Rpb24gdXNlUmVkaXMoY29uZmlnOiBhbnkpOiBib29sZWFuIHtcbiAgY29uc3QgcmVkaXNVUkwgPSBjb25maWcucmVkaXNVUkw7XG4gIHJldHVybiB0eXBlb2YgcmVkaXNVUkwgIT09ICd1bmRlZmluZWQnICYmIHJlZGlzVVJMICE9PSAnJztcbn1cblxuUGFyc2VQdWJTdWIuY3JlYXRlUHVibGlzaGVyID0gZnVuY3Rpb24gKGNvbmZpZzogYW55KTogYW55IHtcbiAgaWYgKHVzZVJlZGlzKGNvbmZpZykpIHtcbiAgICByZXR1cm4gUmVkaXNQdWJTdWIuY3JlYXRlUHVibGlzaGVyKGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgYWRhcHRlciA9IGxvYWRBZGFwdGVyKGNvbmZpZy5wdWJTdWJBZGFwdGVyLCBFdmVudEVtaXR0ZXJQdWJTdWIsIGNvbmZpZyk7XG4gICAgaWYgKHR5cGVvZiBhZGFwdGVyLmNyZWF0ZVB1Ymxpc2hlciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgJ3B1YlN1YkFkYXB0ZXIgc2hvdWxkIGhhdmUgY3JlYXRlUHVibGlzaGVyKCknO1xuICAgIH1cbiAgICByZXR1cm4gYWRhcHRlci5jcmVhdGVQdWJsaXNoZXIoY29uZmlnKTtcbiAgfVxufTtcblxuUGFyc2VQdWJTdWIuY3JlYXRlU3Vic2NyaWJlciA9IGZ1bmN0aW9uIChjb25maWc6IGFueSk6IHZvaWQge1xuICBpZiAodXNlUmVkaXMoY29uZmlnKSkge1xuICAgIHJldHVybiBSZWRpc1B1YlN1Yi5jcmVhdGVTdWJzY3JpYmVyKGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgYWRhcHRlciA9IGxvYWRBZGFwdGVyKGNvbmZpZy5wdWJTdWJBZGFwdGVyLCBFdmVudEVtaXR0ZXJQdWJTdWIsIGNvbmZpZyk7XG4gICAgaWYgKHR5cGVvZiBhZGFwdGVyLmNyZWF0ZVN1YnNjcmliZXIgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRocm93ICdwdWJTdWJBZGFwdGVyIHNob3VsZCBoYXZlIGNyZWF0ZVN1YnNjcmliZXIoKSc7XG4gICAgfVxuICAgIHJldHVybiBhZGFwdGVyLmNyZWF0ZVN1YnNjcmliZXIoY29uZmlnKTtcbiAgfVxufTtcblxuZXhwb3J0IHsgUGFyc2VQdWJTdWIgfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOztBQUVBOztBQUVBLE1BQU1BLFdBQVcsR0FBRyxFQUFwQjs7O0FBRUEsU0FBU0MsUUFBVCxDQUFrQkMsTUFBbEIsRUFBd0M7RUFDdEMsTUFBTUMsUUFBUSxHQUFHRCxNQUFNLENBQUNDLFFBQXhCO0VBQ0EsT0FBTyxPQUFPQSxRQUFQLEtBQW9CLFdBQXBCLElBQW1DQSxRQUFRLEtBQUssRUFBdkQ7QUFDRDs7QUFFREgsV0FBVyxDQUFDSSxlQUFaLEdBQThCLFVBQVVGLE1BQVYsRUFBNEI7RUFDeEQsSUFBSUQsUUFBUSxDQUFDQyxNQUFELENBQVosRUFBc0I7SUFDcEIsT0FBT0csd0JBQUEsQ0FBWUQsZUFBWixDQUE0QkYsTUFBNUIsQ0FBUDtFQUNELENBRkQsTUFFTztJQUNMLE1BQU1JLE9BQU8sR0FBRyxJQUFBQywwQkFBQSxFQUFZTCxNQUFNLENBQUNNLGFBQW5CLEVBQWtDQyxzQ0FBbEMsRUFBc0RQLE1BQXRELENBQWhCOztJQUNBLElBQUksT0FBT0ksT0FBTyxDQUFDRixlQUFmLEtBQW1DLFVBQXZDLEVBQW1EO01BQ2pELE1BQU0sNkNBQU47SUFDRDs7SUFDRCxPQUFPRSxPQUFPLENBQUNGLGVBQVIsQ0FBd0JGLE1BQXhCLENBQVA7RUFDRDtBQUNGLENBVkQ7O0FBWUFGLFdBQVcsQ0FBQ1UsZ0JBQVosR0FBK0IsVUFBVVIsTUFBVixFQUE2QjtFQUMxRCxJQUFJRCxRQUFRLENBQUNDLE1BQUQsQ0FBWixFQUFzQjtJQUNwQixPQUFPRyx3QkFBQSxDQUFZSyxnQkFBWixDQUE2QlIsTUFBN0IsQ0FBUDtFQUNELENBRkQsTUFFTztJQUNMLE1BQU1JLE9BQU8sR0FBRyxJQUFBQywwQkFBQSxFQUFZTCxNQUFNLENBQUNNLGFBQW5CLEVBQWtDQyxzQ0FBbEMsRUFBc0RQLE1BQXRELENBQWhCOztJQUNBLElBQUksT0FBT0ksT0FBTyxDQUFDSSxnQkFBZixLQUFvQyxVQUF4QyxFQUFvRDtNQUNsRCxNQUFNLDhDQUFOO0lBQ0Q7O0lBQ0QsT0FBT0osT0FBTyxDQUFDSSxnQkFBUixDQUF5QlIsTUFBekIsQ0FBUDtFQUNEO0FBQ0YsQ0FWRCJ9