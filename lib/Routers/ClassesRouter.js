"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ClassesRouter = void 0;

var _PromiseRouter = _interopRequireDefault(require("../PromiseRouter"));

var _rest = _interopRequireDefault(require("../rest"));

var _lodash = _interopRequireDefault(require("lodash"));

var _node = _interopRequireDefault(require("parse/node"));

var _middlewares = require("../middlewares");

var _FunctionsRouter = require("./FunctionsRouter");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const ALLOWED_GET_QUERY_KEYS = ['keys', 'include', 'excludeKeys', 'readPreference', 'includeReadPreference', 'subqueryReadPreference'];

class ClassesRouter extends _PromiseRouter.default {
  className(req) {
    return req.params.className;
  }

  handleFind(req) {
    const body = Object.assign(req.body, ClassesRouter.JSONFromQuery(req.query));
    const options = ClassesRouter.optionsFromBody(body);

    if (req.config.maxLimit && body.limit > req.config.maxLimit) {
      // Silently replace the limit on the query with the max configured
      options.limit = Number(req.config.maxLimit);
    }

    if (body.redirectClassNameForKey) {
      options.redirectClassNameForKey = String(body.redirectClassNameForKey);
    }

    if (typeof body.where === 'string') {
      body.where = JSON.parse(body.where);
    }

    return _rest.default.find(req.config, req.auth, this.className(req), body.where, options, req.info.clientSDK, req.info.context).then(response => {
      return {
        response: response
      };
    });
  } // Returns a promise for a {response} object.


  handleGet(req) {
    const body = Object.assign(req.body, ClassesRouter.JSONFromQuery(req.query));
    const options = {};

    for (const key of Object.keys(body)) {
      if (ALLOWED_GET_QUERY_KEYS.indexOf(key) === -1) {
        throw new _node.default.Error(_node.default.Error.INVALID_QUERY, 'Improper encode of parameter');
      }
    }

    if (body.keys != null) {
      options.keys = String(body.keys);
    }

    if (body.include != null) {
      options.include = String(body.include);
    }

    if (body.excludeKeys != null) {
      options.excludeKeys = String(body.excludeKeys);
    }

    if (typeof body.readPreference === 'string') {
      options.readPreference = body.readPreference;
    }

    if (typeof body.includeReadPreference === 'string') {
      options.includeReadPreference = body.includeReadPreference;
    }

    if (typeof body.subqueryReadPreference === 'string') {
      options.subqueryReadPreference = body.subqueryReadPreference;
    }

    return _rest.default.get(req.config, req.auth, this.className(req), req.params.objectId, options, req.info.clientSDK, req.info.context).then(response => {
      if (!response.results || response.results.length == 0) {
        throw new _node.default.Error(_node.default.Error.OBJECT_NOT_FOUND, 'Object not found.');
      }

      if (this.className(req) === '_User') {
        delete response.results[0].sessionToken;
        const user = response.results[0];

        if (req.auth.user && user.objectId == req.auth.user.id) {
          // Force the session token
          response.results[0].sessionToken = req.info.sessionToken;
        }
      }

      return {
        response: response.results[0]
      };
    });
  }

  handleCreate(req) {
    return _rest.default.create(req.config, req.auth, this.className(req), req.body, req.info.clientSDK, req.info.context);
  }

  handleUpdate(req) {
    const where = {
      objectId: req.params.objectId
    };
    return _rest.default.update(req.config, req.auth, this.className(req), where, req.body, req.info.clientSDK, req.info.context);
  }

  handleDelete(req) {
    return _rest.default.del(req.config, req.auth, this.className(req), req.params.objectId, req.info.context).then(() => {
      return {
        response: {}
      };
    });
  }

  static JSONFromQuery(query) {
    const json = {};

    for (const [key, value] of _lodash.default.entries(query)) {
      try {
        json[key] = JSON.parse(value);
      } catch (e) {
        json[key] = value;
      }
    }

    return json;
  }

  static optionsFromBody(body) {
    const allowConstraints = ['skip', 'limit', 'order', 'count', 'keys', 'excludeKeys', 'include', 'includeAll', 'redirectClassNameForKey', 'where', 'readPreference', 'includeReadPreference', 'subqueryReadPreference', 'hint', 'explain'];

    for (const key of Object.keys(body)) {
      if (allowConstraints.indexOf(key) === -1) {
        throw new _node.default.Error(_node.default.Error.INVALID_QUERY, `Invalid parameter for query: ${key}`);
      }
    }

    const options = {};

    if (body.skip) {
      options.skip = Number(body.skip);
    }

    if (body.limit || body.limit === 0) {
      options.limit = Number(body.limit);
    } else {
      options.limit = Number(100);
    }

    if (body.order) {
      options.order = String(body.order);
    }

    if (body.count) {
      options.count = true;
    }

    if (body.keys != null) {
      options.keys = String(body.keys);
    }

    if (body.excludeKeys != null) {
      options.excludeKeys = String(body.excludeKeys);
    }

    if (body.include != null) {
      options.include = String(body.include);
    }

    if (body.includeAll) {
      options.includeAll = true;
    }

    if (typeof body.readPreference === 'string') {
      options.readPreference = body.readPreference;
    }

    if (typeof body.includeReadPreference === 'string') {
      options.includeReadPreference = body.includeReadPreference;
    }

    if (typeof body.subqueryReadPreference === 'string') {
      options.subqueryReadPreference = body.subqueryReadPreference;
    }

    if (body.hint && (typeof body.hint === 'string' || typeof body.hint === 'object')) {
      options.hint = body.hint;
    }

    if (body.explain) {
      options.explain = body.explain;
    }

    return options;
  }

  mountRoutes() {
    this.route('GET', '/classes/:className', req => {
      return this.handleFind(req);
    });
    this.route('GET', '/classes/:className/:objectId', req => {
      return this.handleGet(req);
    });
    this.route('POST', '/classes/:className', _middlewares.promiseEnsureIdempotency, req => {
      return this.handleCreate(req);
    });
    this.route('PUT', '/classes/:className/:objectId', _middlewares.promiseEnsureIdempotency, req => {
      return this.handleUpdate(req);
    });
    this.route('DELETE', '/classes/:className/:objectId', req => {
      return this.handleDelete(req);
    }); // NOTE: An alias of cloud function

    this.route('POST', '/classes/:className/:functionName', _middlewares.promiseEnsureIdempotency, req => {
      return _FunctionsRouter.FunctionsRouter.handleCloudFunction(req);
    });
  }

}

exports.ClassesRouter = ClassesRouter;
var _default = ClassesRouter;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJBTExPV0VEX0dFVF9RVUVSWV9LRVlTIiwiQ2xhc3Nlc1JvdXRlciIsIlByb21pc2VSb3V0ZXIiLCJjbGFzc05hbWUiLCJyZXEiLCJwYXJhbXMiLCJoYW5kbGVGaW5kIiwiYm9keSIsIk9iamVjdCIsImFzc2lnbiIsIkpTT05Gcm9tUXVlcnkiLCJxdWVyeSIsIm9wdGlvbnMiLCJvcHRpb25zRnJvbUJvZHkiLCJjb25maWciLCJtYXhMaW1pdCIsImxpbWl0IiwiTnVtYmVyIiwicmVkaXJlY3RDbGFzc05hbWVGb3JLZXkiLCJTdHJpbmciLCJ3aGVyZSIsIkpTT04iLCJwYXJzZSIsInJlc3QiLCJmaW5kIiwiYXV0aCIsImluZm8iLCJjbGllbnRTREsiLCJjb250ZXh0IiwidGhlbiIsInJlc3BvbnNlIiwiaGFuZGxlR2V0Iiwia2V5Iiwia2V5cyIsImluZGV4T2YiLCJQYXJzZSIsIkVycm9yIiwiSU5WQUxJRF9RVUVSWSIsImluY2x1ZGUiLCJleGNsdWRlS2V5cyIsInJlYWRQcmVmZXJlbmNlIiwiaW5jbHVkZVJlYWRQcmVmZXJlbmNlIiwic3VicXVlcnlSZWFkUHJlZmVyZW5jZSIsImdldCIsIm9iamVjdElkIiwicmVzdWx0cyIsImxlbmd0aCIsIk9CSkVDVF9OT1RfRk9VTkQiLCJzZXNzaW9uVG9rZW4iLCJ1c2VyIiwiaWQiLCJoYW5kbGVDcmVhdGUiLCJjcmVhdGUiLCJoYW5kbGVVcGRhdGUiLCJ1cGRhdGUiLCJoYW5kbGVEZWxldGUiLCJkZWwiLCJqc29uIiwidmFsdWUiLCJfIiwiZW50cmllcyIsImUiLCJhbGxvd0NvbnN0cmFpbnRzIiwic2tpcCIsIm9yZGVyIiwiY291bnQiLCJpbmNsdWRlQWxsIiwiaGludCIsImV4cGxhaW4iLCJtb3VudFJvdXRlcyIsInJvdXRlIiwicHJvbWlzZUVuc3VyZUlkZW1wb3RlbmN5IiwiRnVuY3Rpb25zUm91dGVyIiwiaGFuZGxlQ2xvdWRGdW5jdGlvbiJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Sb3V0ZXJzL0NsYXNzZXNSb3V0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByb21pc2VSb3V0ZXIgZnJvbSAnLi4vUHJvbWlzZVJvdXRlcic7XG5pbXBvcnQgcmVzdCBmcm9tICcuLi9yZXN0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgUGFyc2UgZnJvbSAncGFyc2Uvbm9kZSc7XG5pbXBvcnQgeyBwcm9taXNlRW5zdXJlSWRlbXBvdGVuY3kgfSBmcm9tICcuLi9taWRkbGV3YXJlcyc7XG5pbXBvcnQgeyBGdW5jdGlvbnNSb3V0ZXIgfSBmcm9tICcuL0Z1bmN0aW9uc1JvdXRlcic7XG5cbmNvbnN0IEFMTE9XRURfR0VUX1FVRVJZX0tFWVMgPSBbXG4gICdrZXlzJyxcbiAgJ2luY2x1ZGUnLFxuICAnZXhjbHVkZUtleXMnLFxuICAncmVhZFByZWZlcmVuY2UnLFxuICAnaW5jbHVkZVJlYWRQcmVmZXJlbmNlJyxcbiAgJ3N1YnF1ZXJ5UmVhZFByZWZlcmVuY2UnLFxuXTtcblxuZXhwb3J0IGNsYXNzIENsYXNzZXNSb3V0ZXIgZXh0ZW5kcyBQcm9taXNlUm91dGVyIHtcbiAgY2xhc3NOYW1lKHJlcSkge1xuICAgIHJldHVybiByZXEucGFyYW1zLmNsYXNzTmFtZTtcbiAgfVxuXG4gIGhhbmRsZUZpbmQocmVxKSB7XG4gICAgY29uc3QgYm9keSA9IE9iamVjdC5hc3NpZ24ocmVxLmJvZHksIENsYXNzZXNSb3V0ZXIuSlNPTkZyb21RdWVyeShyZXEucXVlcnkpKTtcbiAgICBjb25zdCBvcHRpb25zID0gQ2xhc3Nlc1JvdXRlci5vcHRpb25zRnJvbUJvZHkoYm9keSk7XG4gICAgaWYgKHJlcS5jb25maWcubWF4TGltaXQgJiYgYm9keS5saW1pdCA+IHJlcS5jb25maWcubWF4TGltaXQpIHtcbiAgICAgIC8vIFNpbGVudGx5IHJlcGxhY2UgdGhlIGxpbWl0IG9uIHRoZSBxdWVyeSB3aXRoIHRoZSBtYXggY29uZmlndXJlZFxuICAgICAgb3B0aW9ucy5saW1pdCA9IE51bWJlcihyZXEuY29uZmlnLm1heExpbWl0KTtcbiAgICB9XG4gICAgaWYgKGJvZHkucmVkaXJlY3RDbGFzc05hbWVGb3JLZXkpIHtcbiAgICAgIG9wdGlvbnMucmVkaXJlY3RDbGFzc05hbWVGb3JLZXkgPSBTdHJpbmcoYm9keS5yZWRpcmVjdENsYXNzTmFtZUZvcktleSk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgYm9keS53aGVyZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGJvZHkud2hlcmUgPSBKU09OLnBhcnNlKGJvZHkud2hlcmUpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdFxuICAgICAgLmZpbmQoXG4gICAgICAgIHJlcS5jb25maWcsXG4gICAgICAgIHJlcS5hdXRoLFxuICAgICAgICB0aGlzLmNsYXNzTmFtZShyZXEpLFxuICAgICAgICBib2R5LndoZXJlLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICByZXEuaW5mby5jbGllbnRTREssXG4gICAgICAgIHJlcS5pbmZvLmNvbnRleHRcbiAgICAgIClcbiAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgcmV0dXJuIHsgcmVzcG9uc2U6IHJlc3BvbnNlIH07XG4gICAgICB9KTtcbiAgfVxuXG4gIC8vIFJldHVybnMgYSBwcm9taXNlIGZvciBhIHtyZXNwb25zZX0gb2JqZWN0LlxuICBoYW5kbGVHZXQocmVxKSB7XG4gICAgY29uc3QgYm9keSA9IE9iamVjdC5hc3NpZ24ocmVxLmJvZHksIENsYXNzZXNSb3V0ZXIuSlNPTkZyb21RdWVyeShyZXEucXVlcnkpKTtcbiAgICBjb25zdCBvcHRpb25zID0ge307XG5cbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhib2R5KSkge1xuICAgICAgaWYgKEFMTE9XRURfR0VUX1FVRVJZX0tFWVMuaW5kZXhPZihrZXkpID09PSAtMSkge1xuICAgICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuSU5WQUxJRF9RVUVSWSwgJ0ltcHJvcGVyIGVuY29kZSBvZiBwYXJhbWV0ZXInKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYm9keS5rZXlzICE9IG51bGwpIHtcbiAgICAgIG9wdGlvbnMua2V5cyA9IFN0cmluZyhib2R5LmtleXMpO1xuICAgIH1cbiAgICBpZiAoYm9keS5pbmNsdWRlICE9IG51bGwpIHtcbiAgICAgIG9wdGlvbnMuaW5jbHVkZSA9IFN0cmluZyhib2R5LmluY2x1ZGUpO1xuICAgIH1cbiAgICBpZiAoYm9keS5leGNsdWRlS2V5cyAhPSBudWxsKSB7XG4gICAgICBvcHRpb25zLmV4Y2x1ZGVLZXlzID0gU3RyaW5nKGJvZHkuZXhjbHVkZUtleXMpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGJvZHkucmVhZFByZWZlcmVuY2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICBvcHRpb25zLnJlYWRQcmVmZXJlbmNlID0gYm9keS5yZWFkUHJlZmVyZW5jZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBib2R5LmluY2x1ZGVSZWFkUHJlZmVyZW5jZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIG9wdGlvbnMuaW5jbHVkZVJlYWRQcmVmZXJlbmNlID0gYm9keS5pbmNsdWRlUmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgYm9keS5zdWJxdWVyeVJlYWRQcmVmZXJlbmNlID09PSAnc3RyaW5nJykge1xuICAgICAgb3B0aW9ucy5zdWJxdWVyeVJlYWRQcmVmZXJlbmNlID0gYm9keS5zdWJxdWVyeVJlYWRQcmVmZXJlbmNlO1xuICAgIH1cblxuICAgIHJldHVybiByZXN0XG4gICAgICAuZ2V0KFxuICAgICAgICByZXEuY29uZmlnLFxuICAgICAgICByZXEuYXV0aCxcbiAgICAgICAgdGhpcy5jbGFzc05hbWUocmVxKSxcbiAgICAgICAgcmVxLnBhcmFtcy5vYmplY3RJZCxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgcmVxLmluZm8uY2xpZW50U0RLLFxuICAgICAgICByZXEuaW5mby5jb250ZXh0XG4gICAgICApXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIGlmICghcmVzcG9uc2UucmVzdWx0cyB8fCByZXNwb25zZS5yZXN1bHRzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFBhcnNlLkVycm9yKFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQsICdPYmplY3Qgbm90IGZvdW5kLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lKHJlcSkgPT09ICdfVXNlcicpIHtcbiAgICAgICAgICBkZWxldGUgcmVzcG9uc2UucmVzdWx0c1swXS5zZXNzaW9uVG9rZW47XG5cbiAgICAgICAgICBjb25zdCB1c2VyID0gcmVzcG9uc2UucmVzdWx0c1swXTtcblxuICAgICAgICAgIGlmIChyZXEuYXV0aC51c2VyICYmIHVzZXIub2JqZWN0SWQgPT0gcmVxLmF1dGgudXNlci5pZCkge1xuICAgICAgICAgICAgLy8gRm9yY2UgdGhlIHNlc3Npb24gdG9rZW5cbiAgICAgICAgICAgIHJlc3BvbnNlLnJlc3VsdHNbMF0uc2Vzc2lvblRva2VuID0gcmVxLmluZm8uc2Vzc2lvblRva2VuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyByZXNwb25zZTogcmVzcG9uc2UucmVzdWx0c1swXSB9O1xuICAgICAgfSk7XG4gIH1cblxuICBoYW5kbGVDcmVhdGUocmVxKSB7XG4gICAgcmV0dXJuIHJlc3QuY3JlYXRlKFxuICAgICAgcmVxLmNvbmZpZyxcbiAgICAgIHJlcS5hdXRoLFxuICAgICAgdGhpcy5jbGFzc05hbWUocmVxKSxcbiAgICAgIHJlcS5ib2R5LFxuICAgICAgcmVxLmluZm8uY2xpZW50U0RLLFxuICAgICAgcmVxLmluZm8uY29udGV4dFxuICAgICk7XG4gIH1cblxuICBoYW5kbGVVcGRhdGUocmVxKSB7XG4gICAgY29uc3Qgd2hlcmUgPSB7IG9iamVjdElkOiByZXEucGFyYW1zLm9iamVjdElkIH07XG4gICAgcmV0dXJuIHJlc3QudXBkYXRlKFxuICAgICAgcmVxLmNvbmZpZyxcbiAgICAgIHJlcS5hdXRoLFxuICAgICAgdGhpcy5jbGFzc05hbWUocmVxKSxcbiAgICAgIHdoZXJlLFxuICAgICAgcmVxLmJvZHksXG4gICAgICByZXEuaW5mby5jbGllbnRTREssXG4gICAgICByZXEuaW5mby5jb250ZXh0XG4gICAgKTtcbiAgfVxuXG4gIGhhbmRsZURlbGV0ZShyZXEpIHtcbiAgICByZXR1cm4gcmVzdFxuICAgICAgLmRlbChyZXEuY29uZmlnLCByZXEuYXV0aCwgdGhpcy5jbGFzc05hbWUocmVxKSwgcmVxLnBhcmFtcy5vYmplY3RJZCwgcmVxLmluZm8uY29udGV4dClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIHsgcmVzcG9uc2U6IHt9IH07XG4gICAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBKU09ORnJvbVF1ZXJ5KHF1ZXJ5KSB7XG4gICAgY29uc3QganNvbiA9IHt9O1xuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIF8uZW50cmllcyhxdWVyeSkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGpzb25ba2V5XSA9IEpTT04ucGFyc2UodmFsdWUpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBqc29uW2tleV0gPSB2YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGpzb247XG4gIH1cblxuICBzdGF0aWMgb3B0aW9uc0Zyb21Cb2R5KGJvZHkpIHtcbiAgICBjb25zdCBhbGxvd0NvbnN0cmFpbnRzID0gW1xuICAgICAgJ3NraXAnLFxuICAgICAgJ2xpbWl0JyxcbiAgICAgICdvcmRlcicsXG4gICAgICAnY291bnQnLFxuICAgICAgJ2tleXMnLFxuICAgICAgJ2V4Y2x1ZGVLZXlzJyxcbiAgICAgICdpbmNsdWRlJyxcbiAgICAgICdpbmNsdWRlQWxsJyxcbiAgICAgICdyZWRpcmVjdENsYXNzTmFtZUZvcktleScsXG4gICAgICAnd2hlcmUnLFxuICAgICAgJ3JlYWRQcmVmZXJlbmNlJyxcbiAgICAgICdpbmNsdWRlUmVhZFByZWZlcmVuY2UnLFxuICAgICAgJ3N1YnF1ZXJ5UmVhZFByZWZlcmVuY2UnLFxuICAgICAgJ2hpbnQnLFxuICAgICAgJ2V4cGxhaW4nLFxuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhib2R5KSkge1xuICAgICAgaWYgKGFsbG93Q29uc3RyYWludHMuaW5kZXhPZihrZXkpID09PSAtMSkge1xuICAgICAgICB0aHJvdyBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuSU5WQUxJRF9RVUVSWSwgYEludmFsaWQgcGFyYW1ldGVyIGZvciBxdWVyeTogJHtrZXl9YCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IG9wdGlvbnMgPSB7fTtcbiAgICBpZiAoYm9keS5za2lwKSB7XG4gICAgICBvcHRpb25zLnNraXAgPSBOdW1iZXIoYm9keS5za2lwKTtcbiAgICB9XG4gICAgaWYgKGJvZHkubGltaXQgfHwgYm9keS5saW1pdCA9PT0gMCkge1xuICAgICAgb3B0aW9ucy5saW1pdCA9IE51bWJlcihib2R5LmxpbWl0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3B0aW9ucy5saW1pdCA9IE51bWJlcigxMDApO1xuICAgIH1cbiAgICBpZiAoYm9keS5vcmRlcikge1xuICAgICAgb3B0aW9ucy5vcmRlciA9IFN0cmluZyhib2R5Lm9yZGVyKTtcbiAgICB9XG4gICAgaWYgKGJvZHkuY291bnQpIHtcbiAgICAgIG9wdGlvbnMuY291bnQgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoYm9keS5rZXlzICE9IG51bGwpIHtcbiAgICAgIG9wdGlvbnMua2V5cyA9IFN0cmluZyhib2R5LmtleXMpO1xuICAgIH1cbiAgICBpZiAoYm9keS5leGNsdWRlS2V5cyAhPSBudWxsKSB7XG4gICAgICBvcHRpb25zLmV4Y2x1ZGVLZXlzID0gU3RyaW5nKGJvZHkuZXhjbHVkZUtleXMpO1xuICAgIH1cbiAgICBpZiAoYm9keS5pbmNsdWRlICE9IG51bGwpIHtcbiAgICAgIG9wdGlvbnMuaW5jbHVkZSA9IFN0cmluZyhib2R5LmluY2x1ZGUpO1xuICAgIH1cbiAgICBpZiAoYm9keS5pbmNsdWRlQWxsKSB7XG4gICAgICBvcHRpb25zLmluY2x1ZGVBbGwgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGJvZHkucmVhZFByZWZlcmVuY2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICBvcHRpb25zLnJlYWRQcmVmZXJlbmNlID0gYm9keS5yZWFkUHJlZmVyZW5jZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBib2R5LmluY2x1ZGVSZWFkUHJlZmVyZW5jZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIG9wdGlvbnMuaW5jbHVkZVJlYWRQcmVmZXJlbmNlID0gYm9keS5pbmNsdWRlUmVhZFByZWZlcmVuY2U7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgYm9keS5zdWJxdWVyeVJlYWRQcmVmZXJlbmNlID09PSAnc3RyaW5nJykge1xuICAgICAgb3B0aW9ucy5zdWJxdWVyeVJlYWRQcmVmZXJlbmNlID0gYm9keS5zdWJxdWVyeVJlYWRQcmVmZXJlbmNlO1xuICAgIH1cbiAgICBpZiAoYm9keS5oaW50ICYmICh0eXBlb2YgYm9keS5oaW50ID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgYm9keS5oaW50ID09PSAnb2JqZWN0JykpIHtcbiAgICAgIG9wdGlvbnMuaGludCA9IGJvZHkuaGludDtcbiAgICB9XG4gICAgaWYgKGJvZHkuZXhwbGFpbikge1xuICAgICAgb3B0aW9ucy5leHBsYWluID0gYm9keS5leHBsYWluO1xuICAgIH1cbiAgICByZXR1cm4gb3B0aW9ucztcbiAgfVxuXG4gIG1vdW50Um91dGVzKCkge1xuICAgIHRoaXMucm91dGUoJ0dFVCcsICcvY2xhc3Nlcy86Y2xhc3NOYW1lJywgcmVxID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUZpbmQocmVxKTtcbiAgICB9KTtcbiAgICB0aGlzLnJvdXRlKCdHRVQnLCAnL2NsYXNzZXMvOmNsYXNzTmFtZS86b2JqZWN0SWQnLCByZXEgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlR2V0KHJlcSk7XG4gICAgfSk7XG4gICAgdGhpcy5yb3V0ZSgnUE9TVCcsICcvY2xhc3Nlcy86Y2xhc3NOYW1lJywgcHJvbWlzZUVuc3VyZUlkZW1wb3RlbmN5LCByZXEgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlQ3JlYXRlKHJlcSk7XG4gICAgfSk7XG4gICAgdGhpcy5yb3V0ZSgnUFVUJywgJy9jbGFzc2VzLzpjbGFzc05hbWUvOm9iamVjdElkJywgcHJvbWlzZUVuc3VyZUlkZW1wb3RlbmN5LCByZXEgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlVXBkYXRlKHJlcSk7XG4gICAgfSk7XG4gICAgdGhpcy5yb3V0ZSgnREVMRVRFJywgJy9jbGFzc2VzLzpjbGFzc05hbWUvOm9iamVjdElkJywgcmVxID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZURlbGV0ZShyZXEpO1xuICAgIH0pO1xuXG4gICAgLy8gTk9URTogQW4gYWxpYXMgb2YgY2xvdWQgZnVuY3Rpb25cbiAgICB0aGlzLnJvdXRlKCdQT1NUJywgJy9jbGFzc2VzLzpjbGFzc05hbWUvOmZ1bmN0aW9uTmFtZScsIHByb21pc2VFbnN1cmVJZGVtcG90ZW5jeSwgcmVxID0+IHtcbiAgICAgIHJldHVybiBGdW5jdGlvbnNSb3V0ZXIuaGFuZGxlQ2xvdWRGdW5jdGlvbihyZXEpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IENsYXNzZXNSb3V0ZXI7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLE1BQU1BLHNCQUFzQixHQUFHLENBQzdCLE1BRDZCLEVBRTdCLFNBRjZCLEVBRzdCLGFBSDZCLEVBSTdCLGdCQUo2QixFQUs3Qix1QkFMNkIsRUFNN0Isd0JBTjZCLENBQS9COztBQVNPLE1BQU1DLGFBQU4sU0FBNEJDLHNCQUE1QixDQUEwQztFQUMvQ0MsU0FBUyxDQUFDQyxHQUFELEVBQU07SUFD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